<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>General Concepts - april-asr Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">README</a></li><li class="chapter-item expanded "><a href="concepts.html" class="active"><strong aria-hidden="true">1.</strong> General Concepts</a></li><li class="chapter-item expanded "><a href="models.html"><strong aria-hidden="true">2.</strong> Model Downloads</a></li><li class="chapter-item expanded affix "><li class="part-title">Language Bindings</li><li class="chapter-item expanded "><a href="python.html"><strong aria-hidden="true">3.</strong> Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="april_asr/index.html"><strong aria-hidden="true">3.1.</strong> API reference</a></li></ol></li><li class="chapter-item expanded "><a href="csharp.html"><strong aria-hidden="true">4.</strong> C#</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="csharp/html/namespace_april_asr.html"><strong aria-hidden="true">4.1.</strong> API reference</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">april-asr Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="general-concepts"><a class="header" href="#general-concepts">General Concepts</a></h1>
<p>Before writing any code, it's recommended to understand these concepts. These apply to all of the language bindings.</p>
<h2 id="model"><a class="header" href="#model">Model</a></h2>
<p><img src="./model.png" alt="Model Diagram" /></p>
<p>Models end with the file extension <code>.april</code>. You can load these files using the AprilASR API.</p>
<p>Each model has its own sample rate in which it expects audio. There is a method to get the expected sample rate. Usually, this is 16000 Hz.</p>
<p>Models also have additional metadata such as name, description, language.</p>
<p>After loading a model, you can create one or more sessions that use the model.</p>
<h2 id="session"><a class="header" href="#session">Session</a></h2>
<p><img src="./session.png" alt="Session Diagram" /></p>
<p>In the most common case, you will have one session based on one model.</p>
<p>The session is what performs the actual speech recognition. It has methods to input audio, and it calls your given handler with decoded results.</p>
<!--(This feature is not yet implemented) When creating a session, you may specify a speaker ID or name. If not empty, this may be used to save and restore the hidden state, to help initialize the session in a way it can provide more accurate results instantly for a particular speaker. -->
<h3 id="decoding"><a class="header" href="#decoding">Decoding</a></h3>
<p><img src="./dataflow.png" alt="Data flow diagram" /></p>
<p>To perform speech-to-text, feed PCM16 audio of the speech to the session through the <code>feed_pcm16</code> method (or equivalent in the language). Make sure it's in the correct sample rate and mono.</p>
<p>PCM16 means array of shorts with values between -32768 to 32767, each one describing one sample.</p>
<p>After calling <code>feed_pcm16</code>, the session will invoke the neural network and call your specified handler with a result. You can present this result to the user or do whatever you want with the result.</p>
<h3 id="multiple-sessions"><a class="header" href="#multiple-sessions">Multiple sessions</a></h3>
<p><img src="./multisession.png" alt="Multi-Session Diagram" /></p>
<p>In more advanced use cases, you may have multiple sessions performing recognition on multiple separate audio streams. When doing this, you can re-use the same model to minimize the memory use.</p>
<h3 id="async-vs-non-async"><a class="header" href="#async-vs-non-async">Async vs Non-Async</a></h3>
<h4 id="synchronous-session-default"><a class="header" href="#synchronous-session-default">Synchronous session (default)</a></h4>
<p><img src="./sync_session.png" alt="Synchronous session diagram" /></p>
<p>The simplest (and default) mode of operation are synchronous sessions.</p>
<p>In a synchronous session, when you call the function to feed audio, it will process the audio synchronously, call the handler if a new result is decoded, and finally return once it's done.</p>
<p>This means that calls to feed audio are extremely slow. This may be undesirable in some cases, such as in a live captioning situation. For this reason, you can choose to construct asynchronous sessions instead.</p>
<h4 id="asynchronous-session"><a class="header" href="#asynchronous-session">Asynchronous session</a></h4>
<p><img src="./async_session.png" alt="Asynchronous session diagram" /></p>
<p>An asynchronous session does not perform calculations on the calling thread.</p>
<p>Calls to feed audio are quick, as it copies the data and triggers a second thread to do the actual calculations. The second thread calls the handler at some point, when processing is done.</p>
<p>A caveat is that you must feed audio at a rate that comes out to 1 second per second. You should not feed multiple seconds or minutes at once. The internal buffer cannot fit more than a few seconds.</p>
<p>Asynchronous sessions are intended for streaming audio as it comes in, for live captioning for example. If you feed more than 1 second every second, you will get poor results (if any).</p>
<h3 id="async-realtime-vs-async-non-realtime"><a class="header" href="#async-realtime-vs-async-non-realtime">Async-Realtime vs Async-Non-Realtime</a></h3>
<p>In an asynchronous session, there is a problem that the system may not be fast enough to process audio at the rate that it's coming in. This is where realtime and non-realtime sessions differ in behavior.</p>
<p><img src="./realtime.png" alt="Realtime session diagram" /></p>
<p>A realtime session will work around this by automatically deciding to speed up incoming audio to a rate where the system can keep up. This involves some audio processing code, which may or may not be desirable.</p>
<p>Speeding up audio may reduce accuracy. It may not be severe at small values (such as 1.2x), but at larger values (such as over 2.0x) the accuracy may be severely impacted. There is a method you can call to get the current speedup value to know when this is happening, so you can display a warning to the user or similar.</p>
<p>A non-realtime session ignores this problem and assumes the system is fast enough. If this is not the case, the results will fall behind, the internal buffer will get full, <code>ErrorCantKeepUp</code> result will be called, and the results will be disastrously horrible.</p>
<h2 id="handler"><a class="header" href="#handler">Handler</a></h2>
<p>The results are given via a callback (handler). It gets called by the session whenever it has new results. The parameters given to the callback include the result type and the token array.</p>
<p>Note that in an asynchronous session, the handler will be called from a different thread. Be sure to expect this and write thread-safe code, or use a synchronous session.</p>
<p>You should try to make your handler function fast to avoid slowing down the session.</p>
<p>The actual text can be extracted from the token array.</p>
<h3 id="result-type"><a class="header" href="#result-type">Result Type</a></h3>
<p>The handler gets called with an enum explaining the result type:</p>
<ul>
<li>Partial Recognition - the token array is a partial result and an updated array will be given in the next call</li>
<li>Final Recognition - the token array is final, the next call will start from an empty array</li>
<li>Error Can't Keep Up - called in an asynchronous non-realtime session if the system is not fast enough, may also be called briefly in an asynchronous realtime session, the token array is empty or null</li>
<li>Silence - there has been silence, the token array is empty or null</li>
</ul>
<h2 id="token"><a class="header" href="#token">Token</a></h2>
<p>A token may be a single letter, a word chunk, an entire word, punctuation, or other arbitrary set of characters.</p>
<p>To convert a token array to a string, simply concatenate the strings from each token. You don't need to add spaces between tokens, the tokens contain their own formatting.</p>
<p><img src="tokens.png" alt="Token example list" /></p>
<p>For example, the text <code>&quot;THAT'S COOL ELEPHANTS&quot;</code> may be represented as tokens like so:</p>
<ul>
<li><code>[&quot; THAT&quot;, &quot;'&quot;, &quot;S&quot;, &quot; CO&quot;, &quot;OL&quot;, &quot; E&quot;, &quot;LE&quot;, &quot;P&quot;, &quot;H&quot;, &quot;ANT&quot;, &quot;S&quot;]</code></li>
<li>Simply concatenating these strings will give you the correct <code>&quot; THAT'S COOL ELEPHANTS&quot;</code>, but with an extra space at the beginning. You may want to strip the final string to avoid the extra space.</li>
</ul>
<p>Tokens contain more data than just the string however. They also contain the log probability, and a boolean denoting whether or not it's a word boundary. In English, the word boundary value is equivalent to checking if the first character is a space.</p>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>AprilASR depends on ONNXRuntime for ML inference. You will need both libraries for it to work:</p>
<ul>
<li>Linux: <code>libaprilasr.so</code> and <code>libonnxruntime.so</code></li>
<li>Windows: <code>libaprilasr.dll</code> and <code>onnxruntime.dll</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="models.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="models.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
